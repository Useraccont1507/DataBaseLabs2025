generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model comments {
  commentid       Int        @id @default(autoincrement())
  text            String
  createdat       DateTime?  @default(now()) @db.Timestamptz(6)
  postid          Int
  userid          Int
  parentcommentid Int?
  comments        comments?  @relation("commentsTocomments", fields: [parentcommentid], references: [commentid], onDelete: Cascade, onUpdate: NoAction)
  other_comments  comments[] @relation("commentsTocomments")
  posts           posts      @relation(fields: [postid], references: [postid], onDelete: Cascade, onUpdate: NoAction)
  users           users      @relation(fields: [userid], references: [userid], onDelete: Cascade, onUpdate: NoAction)
}

model likes {
  likeid    Int       @id @default(autoincrement())
  postid    Int
  userid    Int
  createdat DateTime? @default(now()) @db.Timestamptz(6)
  posts     posts     @relation(fields: [postid], references: [postid], onDelete: Cascade, onUpdate: NoAction)
  users     users     @relation(fields: [userid], references: [userid], onDelete: Cascade, onUpdate: NoAction)

  @@unique([userid, postid])
}

model posts {
  postid    Int        @id @default(autoincrement())
  userid    Int
  title     String     @db.VarChar
  text      String?
  imageurl  String?    @db.VarChar
  createdat DateTime?  @default(now()) @db.Timestamptz(6)
  comments  comments[]
  likes     likes[]
  users     users      @relation(fields: [userid], references: [userid], onDelete: Cascade, onUpdate: NoAction)
  posttags  posttags[]
  postComplaint postComplaint[]
}

model posttags {
  postid Int
  tagid  Int
  posts  posts @relation(fields: [postid], references: [postid], onDelete: Cascade, onUpdate: NoAction)
  tags   tags  @relation(fields: [tagid], references: [tagid], onDelete: Cascade, onUpdate: NoAction)

  @@id([postid, tagid], map: "pk_post_tags")
}

model tags {
  tagid    Int        @id @default(autoincrement())
  text     String     @unique @db.VarChar(16)
  posttags posttags[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model userfollowers {
  id                                     Int   @id @default(autoincrement())
  followerid                             Int
  followingid                            Int
  users_userfollowers_followeridTousers  users @relation("userfollowers_followeridTousers", fields: [followerid], references: [userid], onDelete: Cascade, onUpdate: NoAction)
  users_userfollowers_followingidTousers users @relation("userfollowers_followingidTousers", fields: [followingid], references: [userid], onDelete: Cascade, onUpdate: NoAction)

  @@unique([followerid, followingid])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model users {
  userid                                         Int             @id @default(autoincrement())
  email                                          String          @unique
  password                                       String          @db.VarChar
  nickname                                       String          @db.VarChar(16)
  avatarimageurl                                 String?         @db.VarChar
  createdat                                      DateTime?       @default(now()) @db.Timestamptz(6)
  comments                                       comments[]
  likes                                          likes[]
  posts                                          posts[]
  userfollowers_userfollowers_followeridTousers  userfollowers[] @relation("userfollowers_followeridTousers")
  userfollowers_userfollowers_followingidTousers userfollowers[] @relation("userfollowers_followingidTousers")
  postComplaint postComplaint[]
}

enum ComplaintStatus {
  PENDING
  REVIEWED
  REJECTED
}

model postComplaint {
  postComplaintId Int             @id @default(autoincrement())
  userid          Int
  postid          Int
  status          ComplaintStatus @default(PENDING)
  createdat       DateTime?       @default(now()) @db.Timestamptz(6)

  users           users           @relation(fields: [userid], references: [userid], onDelete: Cascade, onUpdate: NoAction)
  posts           posts           @relation(fields: [postid], references: [postid], onDelete: Cascade, onUpdate: NoAction)

  @@unique([userid, postid])
}