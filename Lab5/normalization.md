# DataBase-Lab5

---

## 1. Функціональні залежності


### Таблиця `Users`
*   **PK:** `userId`
*   `userId` -> `username`, `email`, `passwordHash`, `createdAt`
*   `email` -> `userId` (оскільки email є унікальним)

### Таблиця `Posts`
*   **PK:** `postId`
*   `postId` -> `title`, `content`, `authorId`, `createdAt`
*   `authorId` -> `Users.userId` (Зовнішній ключ)

### Таблиця `Tags`
*   **PK:** `tagId`
*   `tagId` -> `name`

### Таблиця `postTags` (Зв'язок Many-to-Many)
*   **PK (після нормалізації):** `{postId, tagId}`
*   `{postId, tagId}` -> *наявність зв'язку* 
---

## 2. Аналіз NF

### 2.1. 1NF
Усі таблиці (`Users`, `Posts`, `Tags`, `postTags`) містять лише скалярні значення (INT, VARCHAR, TIMESTAMP). Жодне поле не містить масивів або списків (наприклад, "tag1, tag2").

### 2.2. 2NF

*   **Основні таблиці (`Users`, `Posts`):** Мають простий первинний ключ (один стовпець). Часткова залежність неможлива.
*   **Таблиця `postTags` (До нормалізації):**
    *   *Проблема:* Таблиця не мала явного первинного ключа, лише два зовнішні ключі. Це дозволяло створювати дублікати записів (наприклад, один і той самий тег для поста двічі), що є **аномалією надлишковості**.
    *   *Рішення:* Встановлення композитного первинного ключа `(postId, tagId)`.
*   **Висновок:** Після додавання композитного ключа таблиця відповідає **2NF**, оскільки кожен запис унікально ідентифікується повною парою ключів.

### 2.3. Третя нормальна форма (3NF)
*   **Аналіз:**
    *   У таблиці `Posts`, поле `authorId` є зовнішнім ключем, але інші поля (наприклад, `title`) залежать виключно від `postId`, а не від `authorId`.
    *   У таблиці `Users` відсутні залежності типу `ZipCode -> City`.
*   **Висновок:** Схема знаходиться в **3NF**.
---

## 4. Процес нормалізації postTags

Таблиця зв'язку `postTags` потребує доопрацювання для забезпечення цілісності даних.

### Оригінальний дизайн (Порушення цілісності)
Початкова версія таблиці дозволяла дублювання рядків.

| postId | tagId |
| :--- | :--- |
| 10 | 5 |
| 10 | 5 | -- **ДУБЛІКАТ**

### Нормалізований дизайн
**Композитний Первинний Ключ**, який складається з обох колонок.

| postId (PK, FK) | tagId (PK, FK) |
| :--- | :--- |
| 10 | 5 |
*Спроба додати (10, 5) знову призведе до помилки Duplicate entry.*

---

## 5. SQL-скрипти (DDL)

Нижче наведено фінальний SQL-скрипт для створення нормалізованої таблиці зв'язку.

```sql
-- Створення таблиці зв'язку в 3NF з композитним ключем
CREATE TABLE postTags (
    postId INTEGER NOT NULL,
    tagId INTEGER NOT NULL,
    
    CONSTRAINT fk_post FOREIGN KEY (postId) REFERENCES posts(id) ON DELETE CASCADE,
    CONSTRAINT fk_tag FOREIGN KEY (tagId) REFERENCES tags(id) ON DELETE CASCADE,

    CONSTRAINT pk_post_tags PRIMARY KEY (postId, tagId)
);
```

**Верезей Ілля ІМ - 42**

